<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Punto de Venta - Paletería</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Estilos para la impresión */
        @media print {
            body * {
                visibility: hidden;
            }
            #ticket, #ticket * {
                visibility: visible;
            }
            #ticket {
                position: absolute;
                left: 0;
                top: 0;
                width: 58mm; /* Ajuste para la impresora de 58mm */
                font-size: 12px;
            }
            .no-print {
                display: none; /* Aseguramos que todo lo que no deba imprimirse esté oculto */
            }
        }

        /* Mejoramos el diseño del ticket para hacerlo más atractivo */
        #ticket {
            font-family: 'Arial', sans-serif;
            padding: 10px;
            border: 1px solid #ddd;
            width: 58mm;
            margin: 0 auto;
            background-color: #fff;
            font-size: 12px;
            display: none; /* Ocultamos el ticket por defecto */
        }
        #ticket h2 {
            font-size: 16px;
            text-align: center;
            font-weight: bold;
            margin-bottom: 10px;
        }
        #ticket .header {
            text-align: center;
            font-size: 14px;
        }
        #ticket .header p {
            margin: 0;
            font-size: 12px;
        }
        #ticket .product-list {
            margin-top: 10px;
            border-top: 1px solid #000;
            padding-top: 10px;
        }
        #ticket .product-list th, #ticket .product-list td {
            padding: 3px;
            text-align: left;
        }
        #ticket .product-list th {
            font-weight: bold;
        }
        #ticket .product-list td {
            font-size: 12px;
        }
        #ticket .total {
            font-weight: bold;
            font-size: 14px;
            margin-top: 10px;
        }
        #ticket .footer {
            text-align: center;
            font-size: 10px;
            margin-top: 20px;
            border-top: 1px solid #000;
            padding-top: 10px;
        }

        /* Estilo general para la página */
        body {
            background: linear-gradient(to right, #00aaff, #00d9c2); /* Fondo en degradado similar al diseño de la imagen */
            font-family: 'Arial', sans-serif;
        }

        .container {
            max-width: 1280px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Personalización del logo */
        #ticket .header .logo {
            width: 100px;
            height: auto;
            margin: 0 auto;
            display: block;
        }

    </style>
</head>
<body class="bg-gray-200 p-4">
    
    <div class="container mx-auto mt-4 grid grid-cols-1 md:grid-cols-4 gap-4">
        <!-- Panel de búsqueda y lista de productos -->
        <div class="md:col-span-3 bg-white p-4 shadow rounded-lg">
            <input type="text" id="searchBar" placeholder="Buscar artículo" class="w-full px-3 py-2 border rounded-lg" onclick="openModal('searchModal')">
            
            <div class="mt-4 grid grid-cols-2 md:grid-cols-5 gap-2">
                <button class="bg-yellow-400 p-3 rounded-lg shadow" onclick="openModal('categoryModal', 'helados')">Helados</button>
                <button class="bg-blue-400 p-3 rounded-lg shadow" onclick="openModal('categoryModal', 'paletas')">Paletas</button>
                <button class="bg-green-400 p-3 rounded-lg shadow" onclick="openModal('categoryModal', 'refrescos')">Refrescos</button>
                <button class="bg-purple-400 p-3 rounded-lg shadow" onclick="openModal('categoryModal', 'snacks')">Snacks</button>
                <button class="bg-gray-400 p-3 rounded-lg shadow">Más...</button>
            </div>
            
            <!-- Tabla de productos seleccionados -->
            <div class="mt-6">
                <table id="productTable" class="min-w-full bg-white shadow rounded-lg">
                    <thead>
                        <tr>
                            <th class="text-left p-3 bg-gray-200">Descripción</th>
                            <th class="text-left p-3 bg-gray-200">Cantidad</th>
                            <th class="text-left p-3 bg-gray-200">Precio</th>
                            <th class="text-left p-3 bg-gray-200">Total</th>
                            <th class="text-left p-3 bg-gray-200">Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="selectedProductsTable">
                        <!-- Los productos seleccionados se llenarán aquí -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- Panel de detalles de compra -->
        <div class="bg-white p-4 shadow rounded-lg flex flex-col space-y-4">
            <p class="text-lg font-bold">Total a pagar:</p>
            <p id="totalPrice" class="text-2xl font-bold text-green-600">$0.00</p>
            <div class="flex space-x-2">
                <button class="w-full bg-blue-500 text-white py-2 rounded-lg hover:bg-blue-600 focus:outline-none">Pagar con Tarjeta</button>
                <button id="payCashBtn" class="w-full bg-green-500 text-white py-2 rounded-lg hover:bg-green-600 focus:outline-none" onclick="openPaymentModal()">Pagar en Efectivo</button>
            </div>
        </div>
    </div>

    <!-- Modal de Pago en Efectivo -->
    <div id="paymentModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center">
        <div class="bg-white p-6 rounded-lg shadow-lg w-3/4 h-3/4 relative">
            <button onclick="closeModal('paymentModal')" class="absolute top-2 right-4 text-gray-600">✖</button>
            <h3 class="text-center font-bold text-lg">Pago en Efectivo</h3>
            <div class="mt-4">
                <label for="amountToPay" class="block text-sm">Cantidad a pagar:</label>
                <input type="text" id="amountToPay" value="$" readonly class="w-full px-3 py-2 border rounded-lg mb-4">
                
                <label for="amountPaid" class="block text-sm">Cantidad pagada:</label>
                <input type="number" id="amountPaid" class="w-full px-3 py-2 border rounded-lg mb-4" oninput="calculateChange()">
                
                <label for="change" class="block text-sm">Cambio:</label>
                <input type="text" id="change" value="$0.00" readonly class="w-full px-3 py-2 border rounded-lg mb-4">
            </div>
            <div class="flex justify-center space-x-4">
                <button onclick="processPayment()" class="bg-green-500 text-white py-2 px-4 rounded-lg">Aceptar</button>
            </div>
        </div>
    </div>

    <!-- Modal de Categoría de productos (Categorías como Helados, Paletas, etc.) -->
    <div id="categoryModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center">
        <div class="bg-white p-6 rounded-lg shadow-lg w-3/4 h-3/4 relative">
            <button onclick="closeModal('categoryModal')" class="absolute top-2 right-4 text-gray-600">✖</button>
            <h3 class="text-center font-bold text-lg">Selecciona un producto</h3>
            <div id="categoryProducts" class="overflow-y-auto h-60 border p-2 grid grid-cols-2 md:grid-cols-3 gap-2">
                <!-- Los productos de la categoría seleccionada se llenarán aquí -->
            </div>
        </div>
    </div>

    <!-- Div oculto para el ticket -->
    <div id="ticket" class="no-print">
        <h2 class="text-center text-xl font-bold">TICKET DE VENTA</h2>
        <div class="header">
            <!-- Agregamos el logo aquí -->
            <div class="text-center mb-4">
                <img src="C:\wamp64\www\pos\Frontend\web\imagenes\logo.JPG" alt="Logo" class="logo">
            </div>
            <p><strong>Negocio:</strong> Paletería EL PAPAN</p>
            <p><strong>Dirección:</strong> Calle Ficticia #123</p>
            <p><strong>Fecha:</strong> <span id="ticketDate"></span></p>
        </div>
        <div class="product-list">
            <table class="w-full">
                <thead>
                    <tr>
                        <th class="text-left p-1">Producto</th>
                        <th class="text-left p-1">Cantidad</th>
                        <th class="text-left p-1">Total</th>
                    </tr>
                </thead>
                <tbody id="ticketProducts">
                    <!-- Aquí se llenarán los productos -->
                </tbody>
            </table>
        </div>
        <div class="total">
            <p><strong>Total a pagar:</strong> $<span id="ticketTotal"></span></p>
        </div>
        <div class="footer">
            <p>Gracias por su compra.</p>
        </div>
    </div>

    <script>
        const products = {
            helados: [{name: "Helado de Chocolate", price: 30}, {name: "Helado de Vainilla", price: 28}, {name: "Helado de Fresa", price: 25}],
            paletas: [{name: "Paleta de Mango", price: 15}, {name: "Paleta de Coco", price: 18}, {name: "Paleta de Tamarindo", price: 20}],
            refrescos: [{name: "Coca-Cola", price: 18}, {name: "Sprite", price: 16}, {name: "Fanta", price: 17}],
            snacks: [{name: "Papas", price: 12}, {name: "Chocolates", price: 25}, {name: "Galletas", price: 15}]
        };
        let selectedItems = [];
        let totalAmount = 0;

        function openModal(modalId, category = null) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.remove("hidden");
                if (category) {
                    loadCategoryProducts(category);
                }
            } else {
                console.error(`Modal con ID ${modalId} no encontrado.`);
            }
        }

        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.add("hidden");
            } else {
                console.error(`Modal con ID ${modalId} no encontrado.`);
            }
        }

        function loadCategoryProducts(category) {
            const display = document.getElementById("categoryProducts");
            display.innerHTML = "";
            products[category].forEach(product => {
                const button = document.createElement("button");
                button.classList = "bg-gray-300 p-2 rounded-lg shadow w-full";
                button.textContent = `${product.name} - $${product.price}`;
                button.onclick = () => selectProduct(product);
                display.appendChild(button);
            });
        }

        function selectProduct(product) {
            const quantity = prompt(`Ingrese la cantidad de ${product.name}:`, 1);
            if (quantity && !isNaN(quantity) && quantity > 0) {
                const existingProduct = selectedItems.find(item => item.name === product.name);
                
                if (existingProduct) {
                    existingProduct.quantity += parseInt(quantity);
                    existingProduct.total = existingProduct.price * existingProduct.quantity;
                } else {
                    selectedItems.push({ 
                        name: product.name, 
                        quantity: parseInt(quantity),
                        price: product.price, 
                        total: product.price * quantity 
                    });
                }
                
                updateTable();
                updateTotal();
            }
        }

        function updateTable() {
            const tableBody = document.getElementById("selectedProductsTable");
            tableBody.innerHTML = "";  // Limpiar la tabla antes de agregar los productos
            selectedItems.forEach((item, index) => {
                const row = document.createElement("tr");
                row.innerHTML = `
                    <td class="p-3 border">${item.name}</td>
                    <td class="p-3 border">${item.quantity}</td>
                    <td class="p-3 border">$${item.price}</td>
                    <td class="p-3 border">$${item.total}</td>
                    <td class="p-3 border">
                        <button class="bg-yellow-300 p-2 rounded-lg shadow" onclick="editQuantity(${index})">Editar</button>
                        <button class="bg-red-500 text-white p-2 rounded-lg shadow" onclick="confirmRemoveProduct(${index})">Eliminar</button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        function updateTotal() {
            totalAmount = selectedItems.reduce((total, item) => total + item.total, 0);
            document.getElementById("totalPrice").textContent = `$${totalAmount.toFixed(2)}`;
        }

        function editQuantity(index) {
            const newQuantity = prompt(`Ingrese la nueva cantidad para ${selectedItems[index].name}:`, selectedItems[index].quantity);
            if (newQuantity && !isNaN(newQuantity) && newQuantity > 0) {
                selectedItems[index].quantity = parseInt(newQuantity);
                selectedItems[index].total = selectedItems[index].price * selectedItems[index].quantity;
                updateTable();
                updateTotal();
            }
        }

        function confirmRemoveProduct(index) {
            const isConfirmed = confirm("¿Está seguro de que desea eliminar este producto?");
            if (isConfirmed) {
                removeProduct(index);
            }
        }

        function removeProduct(index) {
            selectedItems.splice(index, 1);
            updateTable();
            updateTotal();
        }

        function printTicket() {
            const ticketProducts = document.getElementById("ticketProducts");
            const ticketTotal = document.getElementById("ticketTotal");
            const ticketDate = document.getElementById("ticketDate");
            
            // Llenar los datos del ticket
            ticketDate.textContent = new Date().toLocaleString();
            ticketProducts.innerHTML = "";
            selectedItems.forEach(item => {
                const row = document.createElement("tr");
                row.innerHTML = `
                    <td class="p-1">${item.name}</td>
                    <td class="p-1">${item.quantity}</td>
                    <td class="p-1">$${item.total}</td>
                `;
                ticketProducts.appendChild(row);
            });
            ticketTotal.textContent = `$${totalAmount.toFixed(2)}`;
            
            // Mostrar el ticket y luego imprimir
            document.getElementById("ticket").style.display = 'block'; // Muestra el ticket
            window.print(); // Inicia la impresión
            document.getElementById("ticket").style.display = 'none'; // Oculta el ticket después de imprimir
        }
        
        function openPaymentModal() {
            document.getElementById("amountToPay").value = `$${totalAmount.toFixed(2)}`;
            document.getElementById("amountPaid").value = '';
            document.getElementById("change").value = '$0.00';
            openModal('paymentModal');
        }

        function calculateChange() {
            const amountPaid = parseFloat(amountPaidInput.value) || 0;
            const change = amountPaid - totalAmount;
    
            // Actualizar el cambio en el campo de texto
            document.getElementById("change").value = `$${Math.max(0, change).toFixed(2)}`;
    
            // Si el monto pagado es mayor que 0, habilitar el botón "Aceptar"
            if (amountPaid > 0) {
                acceptBtn.disabled = false;
            } else {
                acceptBtn.disabled = true;
            }
        }

        function processPayment() {
            // Llenar los datos del ticket
            const ticketProducts = document.getElementById("ticketProducts");
            const ticketTotal = document.getElementById("ticketTotal");
            const ticketDate = document.getElementById("ticketDate");
            
            ticketDate.textContent = new Date().toLocaleString();
            ticketProducts.innerHTML = "";
            selectedItems.forEach(item => {
                const row = document.createElement("tr");
                row.innerHTML = `
                    <td class="p-1">${item.name}</td>
                    <td class="p-1">${item.quantity}</td>
                    <td class="p-1">$${item.total}</td>
                `;
                ticketProducts.appendChild(row);
            });
            ticketTotal.textContent = `$${totalAmount.toFixed(2)}`;
            
            // Mostrar el ticket y luego imprimir
            document.getElementById("ticket").style.display = 'block'; // Muestra el ticket
            window.print(); // Inicia la impresión
            document.getElementById("ticket").style.display = 'none'; // Oculta el ticket después de imprimir

             // Limpiar la pantalla para la siguiente venta
    resetSale();
    closeModal('paymentModal')

            closeModal('paymentModal');
        }

        function resetSale() {
            // Limpiar la tabla de productos seleccionados
            selectedItems = [];
            updateTable();
            updateTotal();
        
            // Limpiar el modal de pago
            document.getElementById("amountPaid").value = '';
            document.getElementById("change").value = '$0.00';
        
            // Resetear el total a cero en el panel
            document.getElementById("totalPrice").textContent = "$0.00";
        }
    </script>
</body>
</html>
